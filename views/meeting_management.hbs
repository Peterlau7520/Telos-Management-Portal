<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="assets/img/sidebar-5.jpg">

        <div class="sidebar-wrapper">
            <div class="logo">
                <a href="/" class="simple-text">
                    Telos Management Portal
                </a>
                <a href="/" class="simple-text">
                    天羅科技管理平台
                </a>
            </div>

            <ul class="nav">
                <li class="active">
                    <a href="/meetingManagement">
                        <i class="pe-7s-graph"></i>
                        <p>MEETING MANAGEMENT<br>
                            會議管理
                        </p>
                    </a>
                </li>

                <li >
                    <a href="/accountManagement">
                        <i class="pe-7s-user"></i>
                        <p>OWNER's ACCOUNT</p>
                        <p>業主賬戶管理</p>
                    </a>
                </li>
                <li>
                    <a href="/logout">
                        <i class="pe-7s-map-marker"></i>
                        <p>LOG OUT
                            <br>
                            登出</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">MEETING MANGEMENT/會議管理</a>
                </div>
                <div class="collapse navbar-collapse">
                </div>
            </div>
        </nav>

        <div class="content" style="padding-bottom:0; min-height:800px">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">SEND YOUTUBE LINK</h4>
                            </div>
                            <div class="content">
                                <form method="post" enctype="multipart/form-data" action="/sendYouTubeLink">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>選擇屋苑 | SELECT ESTATES</label>
                                                <!--<input type="text" class="form-control" placeholder="Title" name="estateName">-->
                                                <select class="form-control" id="estateYoutube" name="estateYoutube">
                                                    <option value="" selected hidden>Select Estate</option>
                                                    {{#each Estate as |value estate_key|}}
                                                    <option value="{{estate_key}}">{{estateName}}</option>
                                                    {{/each}}
                                                </select>   
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>選擇會議 | SELECT MEETINGS</label>
                                                <select class="form-control" id="meetingYoutube" name="meetingYoutube">
                                                    <option value="">Select Meeting</option>
                                                </select> 
                                            </div>
                                        </div>
                                    </div>
                                      <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>YouTube 鏈接 | YouTube LINK</label>
                                                <input type="text" class="form-control" placeholder="YOUTUBE" name="youtubeLink">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- YOUR WORK HERE -->
                                
                                    <input type="hidden" name="floor_info" id="floor_info"/>
                                    <button type="submit" class="btn btn-info btn-fill pull-right">發送 | Send</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card" style="height: 382px;">
                            <div class="header">
                                <h4 class="title">UPDATE POLL RESULTS</h4>
                            </div>
                            <div class="content">
                                <form method="post" enctype="multipart/form-data" action="/updatePolls">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>選擇屋苑 | SELECT ESTATE</label>
                                                 <select class="form-control" id="estatePoll" name="estatePoll">
                                                 <option value="" selected hidden>Select Estate</option>
                                                 {{#each Estate as |value estate_key|}}
                                                    <option value="{{estate_key}}">{{estateName}}</option>
                                                    {{/each}}
                                                </select> 
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>選擇會議 | SELECT MEETINGS</label>
                                                 <select class="form-control" id="meetingPoll" name="meetingPoll">
                                                    <option value="">{{title}}</option>
                                                </select> 
                                            </div>
                                        </div>
                                    </div>
                                    <!-- YOUR WORK HERE -->
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group pollModal">
                                               
                                            </div>
                                        </div>
                                    </div>
                                    <div class ="pollValue" ></div>
                                    <label style="margin-bottom: -3px;">上傳文件 | ADD DOCUMENTS</label>
                                    <div class="uploadbutton">
                                    <div class="button">Choose file</div>
                                    <div class='input-file-text'>No File Chosen</div>
                                    <input class="input-file" type="file" />
                                    </div>
                                    <button type="submit" class="btn btn-info btn-fill pull-right" style="margin-top: 5px;">上傳 | Upload</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                     <div class="col-md-12">
                       <div class="card">
                            <div class="header">
                                <h4 class="title"> <span id="upcomingMeeting"> ALL UPCOMING MEETINGS </span> / <span id="pastMeeting"> PAST MEETING </span></h4>
                            </div>
                                <div class="content table-responsive table-full-width">
                                <table class="table table-hover table-striped">
                                    <thead>
                                        <th> PROXY FORMS</th>
                                        <th>POLL END TIME</th>
                                        <th>MEETING START TIME</th>
                                        <th>ESTATE NAME</th>
                                        <th>MEETING TITLE</th>
                                        <th>MEETING STATUS</th>
                                        <th></th>
                                    </thead>
                                    <tbody class="tableCtrl">
                                   {{#each upcomingData as |value meeting_key|}} {{#if @key}}
                                        <tr>
                                            <td>  <a href="/generateProxyForms" class="btn btn-info btn-fill">GENERATE</a> </td>
                                            <td>{{pollEndTime}} | {{pollTime}}</td>
                                            <td>
                                             {{startTime}} | <a href="/votingReminder" class="btn btn-danger btn-fill">{{pollTime}}</a>
                                            </td>
                                            <td>{{estate}}</td>
                                           <td> {{title}} | {{titleChn}}</td> 
                                           <td>{{status}}</td>                                  
                                        </tr>
                                        {{/if}}
                                        {{/each}}
                                    </tbody>
                                </table>

                            </div>
                        </div>    
                    </div>
                </div>

            </div>
        </div>

        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Company
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Blog
                            </a>
                        </li>
                    </ul>
                </nav>
                <p class="copyright pull-right">
                    &copy; <script>document.write(new Date().getFullYear())</script> <a href="http://www.creative-tim.com">Creative Tim</a>, made with love for a better web
                </p>
            </div>
        </footer>
    </div>
</div>
<div id="floor_model" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        
    </div>
</div>
<script type="text/javascript">
$(document).ready(function () {
    console.log({{{stringify upcomingData}}})
    var data = '{{{stringify Estate}}}'
    var newdata = JSON.parse(data);
    $('#estateYoutube').change(function() {
        var eState = $(this).val()
        const meeting = newdata[eState].currentMeetings
        $("#meetingYoutube option").remove();
        $("#meetingYoutube").append('<option value="">'+'Select Meeting'+'</option>');
         if(eState){
            //$("#meetingYoutube").val(eState);
             $.each(meeting, function(key,item){  
                $("#meetingYoutube").append('<option value='+item._id+'>'+item.title+'</option>');
            })
         }
    });
    var meeting = ''
    $('#estatePoll').change(function() {
        var eState = $(this).val()
        //eState = JSON.stringify(eState)
        console.log(eState)
        console.log(newdata[eState].currentMeetings)
         meeting = newdata[eState].currentMeetings
        $("#meetingPoll option").remove();
        $("#meetingPoll").append('<option value="">'+'Select Meeting'+'</option>');
         if(eState){
            //$("#meetingYoutube").val(eState);
            $.each(meeting, function(key,item){  
                $("#meetingPoll").append('<option value='+key+'>'+item.title+'</option>');
            })
         }
    });
    var selectedMeeting = ''
    $('#meetingPoll').change(function(event) {
        console.log('change', $(this).val(), meeting)
        const value = $(this).val()
         selectedMeeting = meeting[value]
         console.log(selectedMeeting, "selectedMeeting")
        var Upbtn = '<button type="button" class="btn btn-info btn-fill pollModel">更新投票結果 | Update Poll</button>'
        $(".pollModal").html('');
         $(".pollModal").append(Upbtn, selectedMeeting);
    })

    //edit poll model
    
    function poll_modal(blockdata, selectedMeeting){
        console.log(selectedMeeting, "selectedMeeting", blockdata)
            var html = '<div class="modal-content ModelStyle" style="padding: 10px;">' +
                            '<div class="modal-header">' +
                                '<h4 class="modal-title">更新投票結果 | Update Poll Results</h4>'+
                            '</div>'  
                                    for(i=0; i< selectedMeeting.polls.length; i++){
                                        html = html + 
                                        '<div class="modal-body">' +
                                    '<h6>'+selectedMeeting.polls[i].pollNameChn+' | '+selectedMeeting.polls[i].pollName+'</h6>'+
                                    '<div class="poll">' +
                                    '<input type="hidden" name="id" value='+selectedMeeting.polls[i]._id+' >' + '</div>' 
                                    
                                        for(j=0; j< selectedMeeting.polls[i].options.length; j++){
                                            html = html +
                                            '<div class="col-md-12">' +
                                            '<div class="form-group voting_opt">'+
                                                '<label style="margin-right: 25px; width: 120px; float:left; padding-left: 30px; padding-top:5px;">是 | '+selectedMeeting.polls[i].options[j]+':</label>'+
                                                '<input type="text" class="form-control" style="height:30px; float:left; width:100px; border-radius:0; border:0.5px solid #ccc;" id='+selectedMeeting.polls[i].options[j]+' style="width: 30%; display: inline;" name="option" required/>'+
                                               ' <div class="fortrail">% </div>'+
                                            '</div>' + '</div>'
                                        }
                                        html = html +
                                    '<div>'+    
                                '</div>'+'</div>'
                             }
                        html = html  +
                            '<div class="modal-footer" style="border-top: 0px solid; margin-top: 25px;">' +
                            '<button type="button" class="btn btn btn-info btn-fill CancelBtn" id="cancel1">確定 | Cancel</button>' +
                             '<button type="button" class="btn btn btn-info btn-fill ConfirmBtn" id="cancel">確定 | Confirm</button>'+ 
                            '</div>';
                        return html;
        }
    
    
    
    $(document).on('click','.pollModel',function(event){
            var modeldata = '';
            var modelhtml = poll_modal(modeldata, selectedMeeting);
                $("#floor_model .modal-dialog").html(modelhtml);
                $("#floor_model").modal();
          }) 
    var options = []
    var poll = []
    $(document).on('click','.CancelBtn',function(event){
        $("#floor_model").modal('hide');
    })
    $(document).on('click','.ConfirmBtn',function(event){
        
        $.each($(".poll :input[name*='id']"), function(data1, key1){
            var id = $(this).val()
            console.log(id)
         $.each($(".voting_opt :input[name*='option']"), function(data, key){    
            options.push({choice: $(this).attr('id') , percentage: $(this).val()})
                       //$("#meetingPoll").append('<option value='+key+'>'+item.title+'</option>');
         })
         poll.push({id: id, options: options})
        })
        poll = JSON.stringify(poll)
        var html = `<input type="hidden" name="polls" value=${poll} />` 
          $('.pollValue').append(html)
            console.log(poll, "poll")
            $("#floor_model").modal('hide');
    })
    //upcoming Meeting
    $(document).on("click", "#upcomingMeeting", function (event) {
        console.log({{{stringify upcomingData}}})
        const upcomingnewData = '{{{stringify upcomingData}}}'
        var upcomingData = JSON.parse(upcomingnewData)
        console.log(upcomingData)
        $('.tableCtrl tr').remove();
        $('#upcomingMeeting').css('color', 'Blue');
        $('#pastMeeting').css('color', 'Black');
        var html = '' 
        for(var i=0; i<upcomingData.length; i++){
        html = html + '<tr>'+
                        '<td><a href="/generateProxyForms" class="btn btn-info btn-fill">GENERATE</a></td>'+
                        '<td>'+upcomingData[i].pollEndTime+' | '+upcomingData[i].pollTime+'</td>'+
                        '<td>'+upcomingData[i].startTime+' | <a href="/votingReminder" class="btn btn-danger btn-fill">REMIND</a></td>'+
                        '<td>'+upcomingData[i].estate+'</td>'+
                        '<td> '+upcomingData[i].title+'" | "'+upcomingData[i].titleChn+'</td>'+ 
                       '<td>'+upcomingData[i].status+'</td>'+     
                       '</tr>';
                }
                       $('.tableCtrl').append(html);
    })
    //past Meeting
    $(document).on("click", "#pastMeeting", function (event) {
        $('.tableCtrl tr').remove();
        $('#pastMeeting').css('color', 'Blue');
        $('#upcomingMeeting').css('color', 'Black');
        const pastnewData = '{{{stringify pastData}}}'
        var pastData = JSON.parse(pastnewData)
        var html =''
        for(var i=0; i<pastData.length; i++){
        html = html + '<tr>'+
                        '<td><a href="/generateProxyForms" class="btn btn-info btn-fill">GENERATE</a></td>'+
                        '<td>'+pastData[i].pollEndTime+' | "'+pastData[i].pollTime+' </td>'+
                        '<td>'+pastData[i].startTime+' </td>'+
                        '<td>'+pastData[i].estate+'</td>'+
                        '<td> '+pastData[i].title+' | '+pastData[i].titleChn+'</td>'+ 
                       '<td>'+pastData[i].status+'</td>'+     
                       '</tr>';
                }
                        $('.tableCtrl').append(html);
    })
})
</script>

